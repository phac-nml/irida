<?xml version="1.0" encoding="UTF-8"?>

<databaseChangeLog xmlns="http://www.liquibase.org/xml/ns/dbchangelog"
	xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
	xsi:schemaLocation="http://www.liquibase.org/xml/ns/dbchangelog
         http://www.liquibase.org/xml/ns/dbchangelog/dbchangelog-3.0.xsd">

	<!-- The constraint names generated by hibernate are not intuitive. Instead, 
		we want use a consistent set of constraint names. We need to drop all of 
		the constraints generated by Hibernate, then recreate them. -->
	<changeSet id="3" author="fbristow">
		<!-- alter foreign key constraints from project_user -->
		<dropForeignKeyConstraint baseTableName="project_user"
			constraintName="FK_ptwhmsh2vocln8sffhyvr2ohm" />
		<addForeignKeyConstraint baseColumnNames="project_id"
			baseTableName="project_user" constraintName="FK_PROJECT_USER_PROJECT"
			referencedColumnNames="id" referencedTableName="project" />
		<dropForeignKeyConstraint baseTableName="project_user"
			constraintName="FK_d6kfrxuqknbxrlxhwmn66a3kg" />
		<addForeignKeyConstraint baseColumnNames="user_id"
			baseTableName="project_user" constraintName="FK_PROJECT_USER_USER"
			referencedColumnNames="id" referencedTableName="user" />

		<!-- alter foreign key constraints from project_sample -->
		<dropForeignKeyConstraint baseTableName="project_sample"
			constraintName="FK_mhd5u60xudtj6f8th3kasoy5s" />
		<addForeignKeyConstraint baseColumnNames="project_id"
			baseTableName="project_sample" constraintName="FK_PROJECT_SAMPLE_PROJECT"
			referencedColumnNames="id" referencedTableName="project" />
		<dropForeignKeyConstraint baseTableName="project_sample"
			constraintName="FK_hggs23w3t3ag0tx46v2fdoni0" />
		<addForeignKeyConstraint baseColumnNames="sample_id"
			baseTableName="project_sample" constraintName="FK_PROJECT_SAMPLE_SAMPLE"
			referencedColumnNames="id" referencedTableName="sample" />

		<!-- alter foreign key constraints from sequencefile_sample -->
		<dropForeignKeyConstraint baseTableName="sequencefile_sample"
			constraintName="FK_gnn9w98b5tyk6wyt2affuhviu" />
		<addForeignKeyConstraint baseColumnNames="sample_id"
			baseTableName="sequencefile_sample" constraintName="FK_SEQFILE_SAMPLE_SAMPLE"
			referencedColumnNames="id" referencedTableName="sample" />
		<dropForeignKeyConstraint baseTableName="sequencefile_sample"
			constraintName="FK_pav3r6f727qwk9oxsajqk6o90" />
		<addForeignKeyConstraint baseColumnNames="sequencefile_id"
			baseTableName="sequencefile_sample" constraintName="FK_SEQFILE_SAMPLE_SEQFILE"
			referencedColumnNames="id" referencedTableName="sequence_file" />

		<!-- alter foreign key constraints for sequencefile_overrepresentedsequence -->
		<dropForeignKeyConstraint baseTableName="sequencefile_overrepresentedsequence"
			constraintName="FK_87l76iceme3jcea1vqv1luntl" />
		<addForeignKeyConstraint baseColumnNames="overrepresentedsequence_id"
			baseTableName="sequencefile_overrepresentedsequence" constraintName="FK_SEQFILE_OVERSEQ_OVERSEQ"
			referencedColumnNames="id" referencedTableName="overrepresented_sequence" />
		<dropForeignKeyConstraint baseTableName="sequencefile_overrepresentedsequence"
			constraintName="FK_fitgb03i3bh0yypslc72qeu8h" />
		<addForeignKeyConstraint baseColumnNames="sequencefile_id"
			baseTableName="sequencefile_overrepresentedsequence" constraintName="FK_SEQFILE_OVERSEQ_SEQFILE"
			referencedColumnNames="id" referencedTableName="sequence_file" />

		<!-- alter foreign key constraints for miseqrun_sequencefile -->
		<dropForeignKeyConstraint baseTableName="miseqrun_sequencefile"
			constraintName="FK_gopqduar4x49levqfaxlf5ya3" />
		<addForeignKeyConstraint baseColumnNames="miseqRun_id"
			baseTableName="miseqrun_sequencefile" constraintName="FK_MISEQ_SEQFILE_MISEQ"
			referencedColumnNames="id" referencedTableName="miseq_run" />
		<dropForeignKeyConstraint baseTableName="miseqrun_sequencefile"
			constraintName="FK_31h01pymfikjll61licwjyxtl" />
		<addForeignKeyConstraint baseColumnNames="sequenceFile_id"
			baseTableName="miseqrun_sequencefile" constraintName="FK_MISEQ_SEQFILE_SEQFILE"
			referencedColumnNames="id" referencedTableName="sequence_file" />

		<!-- ******************************** REVISIONS TABLES ******************************* -->
		<!-- alter foreign key constraints for revision -->
		<dropForeignKeyConstraint baseTableName="Revisions"
			constraintName="FK_9h58753k8cr3e19i4buy9dboc" />
		<addForeignKeyConstraint baseColumnNames="user_id"
			baseTableName="Revisions" constraintName="FK_REVISION_CREATED_BY"
			referencedColumnNames="id" referencedTableName="user" />

		<!-- alter foreign key constraints for system_role_AUD -->
		<dropForeignKeyConstraint baseTableName="system_role_AUD"
			constraintName="FK_q3neqt718i8h9x5dxdbb0aj40" />
		<addForeignKeyConstraint baseColumnNames="REV"
			baseTableName="system_role_AUD" constraintName="FK_SYSTEM_ROLE_REVISION"
			referencedColumnNames="id" referencedTableName="Revisions" />

		<!-- alter foreign key constraints for user_AUD -->
		<dropForeignKeyConstraint baseTableName="user_AUD"
			constraintName="FK_ih31uc6fikcf93ek8i9xqfxxo" />
		<addForeignKeyConstraint baseColumnNames="REV"
			baseTableName="user_AUD" constraintName="FK_USER_REVISION"
			referencedColumnNames="id" referencedTableName="Revisions" />

		<!-- alter foreign key constraints for project_AUD -->
		<dropForeignKeyConstraint baseTableName="project_AUD"
			constraintName="FK_n2xwgs7hevwt0ha611ftf085v" />
		<addForeignKeyConstraint baseColumnNames="REV"
			baseTableName="project_AUD" constraintName="FK_PROJECT_REVISION"
			referencedColumnNames="id" referencedTableName="Revisions" />

		<!-- alter foreign key constraints for project_user_AUD -->
		<dropForeignKeyConstraint baseTableName="project_user_AUD"
			constraintName="FK_u80eff5m4010t3wxeydf1h3l" />
		<addForeignKeyConstraint baseColumnNames="REV"
			baseTableName="project_user_AUD" constraintName="FK_PROJECT_USER_REVISION"
			referencedColumnNames="id" referencedTableName="Revisions" />

		<!-- alter foreign key constraints for sample_AUD -->
		<dropForeignKeyConstraint baseTableName="sample_AUD"
			constraintName="FK_630kkpasqawvecp8p2imue78k" />
		<addForeignKeyConstraint baseColumnNames="REV"
			baseTableName="sample_AUD" constraintName="FK_SAMPLE_REVISION"
			referencedColumnNames="id" referencedTableName="Revisions" />

		<!-- alter foreign key constraints for project_sample_AUD -->
		<dropForeignKeyConstraint baseTableName="project_sample_AUD"
			constraintName="FK_arj1cjb0xk8d2ojpdr116nifl" />
		<addForeignKeyConstraint baseColumnNames="REV"
			baseTableName="project_sample_AUD" constraintName="FK_PROJECT_SAMPLE_REVISION"
			referencedColumnNames="id" referencedTableName="Revisions" />

		<!-- alter foreign key constraints for sequence_file_AUD -->
		<dropForeignKeyConstraint baseTableName="sequence_file_AUD"
			constraintName="FK_p455ngkyx9373deuhvtkr0bi2" />
		<addForeignKeyConstraint baseColumnNames="REV"
			baseTableName="sequence_file_AUD" constraintName="FK_SEQFILE_REVISION"
			referencedColumnNames="id" referencedTableName="Revisions" />

		<!-- alter foreign key constraints for sequencefile_sample_AUD -->
		<dropForeignKeyConstraint baseTableName="sequencefile_sample_AUD"
			constraintName="FK_13vxx3bdssdsc1h65i6rpisgk" />
		<addForeignKeyConstraint baseColumnNames="REV"
			baseTableName="sequencefile_sample_AUD" constraintName="FK_SEQFILE_SAMPLE_REVISION"
			referencedColumnNames="id" referencedTableName="Revisions" />

		<!-- alter foreign key constraints for overrepresented_sequence_AUD -->
		<dropForeignKeyConstraint baseTableName="overrepresented_sequence_AUD"
			constraintName="FK_5wdy3sfqgx70dkethxa2clnk9" />
		<addForeignKeyConstraint baseColumnNames="REV"
			baseTableName="overrepresented_sequence_AUD" constraintName="FK_OVERSEQ_REVISION"
			referencedColumnNames="id" referencedTableName="Revisions" />

		<!-- alter foreign key constraints for sequencefile_overrepresentedsequence_AUD -->
		<dropForeignKeyConstraint baseTableName="sequencefile_overrepresentedsequence_AUD"
			constraintName="FK_jdpcpx2lbb7x9msm0j9bf2qwm" />
		<addForeignKeyConstraint baseColumnNames="REV"
			baseTableName="sequencefile_overrepresentedsequence_AUD"
			constraintName="FK_SEQFILE_OVERSEQ_REVISION" referencedColumnNames="id"
			referencedTableName="Revisions" />

		<!-- alter foreign key constraints for miseq_run_AUD -->
		<dropForeignKeyConstraint baseTableName="miseq_run_AUD"
			constraintName="FK_oxvcne374i54prd0c89mud85b" />
		<addForeignKeyConstraint baseColumnNames="REV"
			baseTableName="miseq_run_AUD" constraintName="FK_MISEQ_RUN_REVISION"
			referencedColumnNames="id" referencedTableName="Revisions" />

		<!-- alter foreign key constraints for miseqrun_sequencefile_AUD -->
		<dropForeignKeyConstraint baseTableName="miseqrun_sequencefile_AUD"
			constraintName="FK_h680dca8tfgwcr2lmybogy9kj" />
		<addForeignKeyConstraint baseColumnNames="REV"
			baseTableName="miseqrun_sequencefile_AUD" constraintName="FK_MISEQ_RUN_SEQFILE_REVISION"
			referencedColumnNames="id" referencedTableName="Revisions" />
	</changeSet>
</databaseChangeLog>